#!/bin/bash

set -x

if [ $# == 0 ] || [ $1 == "." ] ; then
    name="$(basename $(pwd))"
else
    name="$1"
    mkdir -p "$name"
    pushd "$name"
    popd=1
fi

if [ "$name" == 'Projects' ]; then
    set +x
    echo 'Refusing to init Projects directory'
    exit 1
fi

[ -f .git ]
dotgit_existed=$?

[ -f package.json ]
package_existed=$?

{
    git init
    hub create
    npm init -y
    git add package.json
    git commit -m "chore: add package.json"
} || {
    if [ "$dotgit_existed" != 0 ]; then
        rm -rf .git
    fi

    if [ "$package_existed" != 0 ]; then
        rm -f package.json
    fi

    set +x
    echo "Y'all might wanna delete that project"
    wait 2
    hub browse

    exit 2
}

